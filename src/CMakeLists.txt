FIND_PACKAGE(MyBoost)
FIND_PACKAGE(OpenSSL)

INCLUDE_DIRECTORIES("${CMAKE_CURRENT_SOURCE_DIR}/boost_asio_1_1_0")
INCLUDE_DIRECTORIES("${BOOST_INCLUDE_DIR}")
LINK_DIRECTORIES("${BOOST_LIBRARY_DIR}")

SUBDIRS(net-asio)
SUBDIRS(qt-gui)
SUBDIRS(bench)
SUBDIRS(util)

SET(BUILDVER_FILE
	"${PROJECT_BINARY_DIR}/BuildVersion.h"
)

INCLUDE_DIRECTORIES("${PROJECT_BINARY_DIR}")
IF(EXISTS "${BUILDVER_FILE}")
ELSE(EXISTS "${BUILDVER_FILE}")
	file(WRITE "${BUILDVER_FILE}" "// generated version file\n")
	file(APPEND "${BUILDVER_FILE}" "#define VERSION_MAJOR_STRING \"0\"\n")
	file(APPEND "${BUILDVER_FILE}" "#define VERSION_MINOR_STRING \"0\"\n")
	file(APPEND "${BUILDVER_FILE}" "#define VERSION_REV_STRING \"0\"\n")
	SET(BUILDVER_FILE "")
ENDIF(EXISTS "${BUILDVER_FILE}")

SET(UFTT_SOURCES
	Main.cpp

	Types.h
	BuildString.h         "${BUILDVER_FILE}"
	SimpleBackend.h       SimpleBackend.cpp

	AutoUpdate.h          AutoUpdate.cpp

	qt-gui/Icons/icon.rc

	Platform.h            Platform.cpp
)

SET(UFTT_LIBRARIES
	uftt-qt
	lib-net-asio
	lib-util
)

ADD_EXECUTABLE(uftt ${UFTT_SOURCES} "${CMAKE_CURRENT_BINARY_DIR}/BuildStringMacros.cpp")

ADD_CUSTOM_COMMAND(OUTPUT "${CMAKE_CURRENT_BINARY_DIR}/BuildStringMacros.cpp"
	COMMAND "${CMAKE_COMMAND}"
	ARGS -E copy "${CMAKE_CURRENT_SOURCE_DIR}/BuildStringMacros.cpp" "${CMAKE_CURRENT_BINARY_DIR}/BuildStringMacros.cpp"
	COMMENT "VersionTarget"
	DEPENDS ${UFTT_SOURCES} ${UFTT_LIBRARIES}
	)

if(OPENSSL_FOUND)
	add_definitions("-DUSE_OPENSSL")
	INCLUDE_DIRECTORIES("${OPENSSL_INCLUDE_DIR}")
	TARGET_LINK_LIBRARIES(uftt
		${OPENSSL_LIBRARY}
	)
endif(OPENSSL_FOUND)

IF(MSVC)
	SET_TARGET_PROPERTIES(uftt PROPERTIES
		LINK_FLAGS_RELEASE "/SUBSYSTEM:WINDOWS"
	)
ENDIF(MSVC)

TARGET_LINK_LIBRARIES(uftt
	${BOOST_THREAD_LIBRARY}
	${BOOST_SERIALIZATION_LIBRARY}
	${BOOST_SYSTEM_LIBRARY}
	${BOOST_SIGNALS_LIBRARY}
	${UFTT_LIBRARIES}
)

